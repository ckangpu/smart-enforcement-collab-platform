# 架构决策记录（ADR）## ADR-001 数据库与隔离- 决策：Postgres + Row Level Security（RLS）实现战区（group_id）硬隔离- 原因：避免应用层漏加过滤导致越权；降低安全风险- 约束：每个请求必须注入 app.* session 变量## ADR-002 服务形态- 决策：模块化单体（api-service）+ worker-service- 原因：V1一致性优先、迭代快；V2可拆通知/搜索/集成/AI- 约束：模块边界明确，禁止跨模块直接写表## ADR-003 事件总线- 决策：Outbox（DB 表）+ worker 消费- 原因：事务一致；V1不引入Kafka复杂度- 约束：dedupe_key 唯一；event_consumption 去重；重试与死信## ADR-004 文件预览与水印- 决策：S3 存储 raw；预览生成 preview 产物- 外协：强水印（满屏斜向）+ 图像化PDF（不可复制文本）- 约束：预览 token 10分钟；外协禁下载 raw；预览/下载全审计## ADR-005 认证- 决策：短信登录 + 用户名（先不接SSO）- 约束：验证码频控、防刷；水印包含用户名+手机后四位（追责）
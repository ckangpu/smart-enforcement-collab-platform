# GitHub Copilot 约束（必须遵守）你正在为“智慧执行协作平台”生成代码。必须遵守以下硬约束，否则生成结果无效：## 红线1) 严禁绕过 Postgres RLS：   - 所有数据访问必须通过注入 app.user_id / app.is_admin / app.group_ids 的 DB 连接执行2) 严禁直接 UPDATE payment 核心字段：   - amount/paid_at/pay_channel/payer_name/bank_last4/case_id/project_id/group_id 不可更新   - 更正必须：新增 payment + corrected_from_payment_id 链接3) 外协永远禁下载/禁导出/禁解密：   - 外协仅允许预览（external variant）4) 客户端 API 必须字段白名单：   - /client/** 不能复用内部 DTO/内部接口响应5) 写操作必须同事务写入：   - 业务表 + audit_log + event_outbox## 架构要求- 模块化单体 + worker- 事件总线：DB Outbox（dedupe_key 唯一）- 幂等：Idempotency-Key（TTL 24h）- 文件：S3 raw + preview- 外协预览：满屏斜向水印 + 图像化 PDF（不可复制文本）## 默认实现偏好- Controller：只校验 DTO，调用 Service- Service：业务规则 + 事务 + 审计 + outbox- Repository：仅 DB 查询/写入- Policy：权限检查集中化## 生成代码前，请先输出你将遵守的约束清单（简短），再生成代码。